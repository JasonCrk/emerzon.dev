---
import { Icon } from 'astro-icon/components'

import { getLangFromUrl, useTranslations } from '../../i18n/utils'

import './styles.css'

const currentPathname = Astro.url.pathname.substring(4)

const lang = getLangFromUrl(Astro.url)
const t = useTranslations(lang)
---

<div class="translate-container">
    <label for="translateButton" class="translate__button">
        <span style="display: none;">.</span>
        <Icon
            name="hugeicons:translate"
            class="translate__button__primary-icon"
        />
        <Icon
            name="hugeicons:arrow-down-01"
            class="translate__button__down_icon"
        />
        <input id="translateButton" type="checkbox" />
    </label>

    <menu class="translate__menu-languages">
        <a href={`/es/${currentPathname}`} class="language"
            >ðŸ‡µðŸ‡ª {t('translation.spanish')}</a
        >
        <a href={`/en/${currentPathname}`} class="language"
            >ðŸ‡ºðŸ‡¸ {t('translation.english')}</a
        >
    </menu>
</div>

<script is:inline lang="ts">
    document.addEventListener('DOMContentLoaded', () => {
        const currentPathname = window.location.pathname.substring(4)
        const language = document.querySelector('html')?.getAttribute('lang')

        const $languageLinks = document.querySelectorAll(
            '.translate__menu-languages a.language',
        )

        const $selectedLanguage = document.querySelector(
            `.translate__menu-languages a[href="/${language}/${currentPathname}"]`,
        )

        $languageLinks.forEach(link => link.classList.remove('active'))

        if ($selectedLanguage) {
            $selectedLanguage.classList.add('language-selected')
        }
    })
</script>
